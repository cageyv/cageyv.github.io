<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self' https://cdnjs.cloudflare.com/ajax/libs/photoswipe/; object-src 'none'; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net/ https://cdnjs.cloudflare.com/ajax/libs/photoswipe/; script-src 'self' 'unsafe-inline' https://code.jquery.com/ https://cdnjs.cloudflare.com/ajax/libs/photoswipe/ https://twemoji.maxcdn.com https://static.cloudflareinsights.com/; prefetch-src 'self'; connect-src 'self';"><meta name=author content="Vladimir Samoylov"><meta name=description content="Don’t have enough resources to set up a security department but want to stay on top of your AWS CloudTrail events? Find out how the CloudTrail-to-Slack Terraform module by FivexL solves this problem for startups and small teams.
Terraform Module for AWS CloudTrail — An Effective Security Tool While large corporations have their own Security Operations Centers (SOCs) responsible for information security and can afford expensive solutions, startups usually don’t have enough resources and time to set up such a luxury."><meta name=keywords content="devops,k8s,aws,terraform,cloud,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="What Is AWS CloudTrail, and Why Do You Need It"><meta name=twitter:description content="Don’t have enough resources to set up a security department but want to stay on top of your AWS CloudTrail events? Find out how the CloudTrail-to-Slack Terraform module by FivexL solves this problem for startups and small teams.
Terraform Module for AWS CloudTrail — An Effective Security Tool While large corporations have their own Security Operations Centers (SOCs) responsible for information security and can afford expensive solutions, startups usually don’t have enough resources and time to set up such a luxury."><meta property="og:title" content="What Is AWS CloudTrail, and Why Do You Need It"><meta property="og:description" content="Don’t have enough resources to set up a security department but want to stay on top of your AWS CloudTrail events? Find out how the CloudTrail-to-Slack Terraform module by FivexL solves this problem for startups and small teams.
Terraform Module for AWS CloudTrail — An Effective Security Tool While large corporations have their own Security Operations Centers (SOCs) responsible for information security and can afford expensive solutions, startups usually don’t have enough resources and time to set up such a luxury."><meta property="og:type" content="article"><meta property="og:url" content="https://cageyv.dev/posts/aws-cloudtrail-to-slack/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-12T00:00:00+00:00"><meta property="article:modified_time" content="2022-07-12T00:00:00+00:00"><meta property="og:see_also" content="https://cageyv.dev/posts/aws-vault/"><meta property="og:see_also" content="https://cageyv.dev/posts/aws-ec2-spot/"><title>What Is AWS CloudTrail, and Why Do You Need It · Vladimir Samoylov</title><link rel=canonical href=https://cageyv.dev/posts/aws-cloudtrail-to-slack/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.1.7" as=font type=font/woff2 integrity="sha256-hEIt6X6xzye8ubyk8/uxjz68cRZHsJxoKS9fQ8idUGQ=" crossorigin><link rel=stylesheet href=/css/coder.min.7845183269a9eb35f70d63bb7521ad5e9470a140d020e12172e0b5d3ed3ec9a3.css integrity="sha256-eEUYMmmp6zX3DWO7dSGtXpRwoUDQIOEhcuC10+0+yaM=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.89c82b6022b96f77aeb521b240daec4f87ea029d84d1c78b8acd0735b91b3c92.css integrity="sha256-icgrYCK5b3eutSGyQNrsT4fqAp2E0ceLis0HNbkbPJI=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><script defer src=https://twemoji.maxcdn.com/v/13.0.1/twemoji.min.js integrity=sha384-5f4X0lBluNY/Ib4VhGx0Pf6iDCF99VGXJIyYy7dDLY5QlEd7Ap0hICSSZA1XYbc4 crossorigin=anonymous></script><meta name=generator content="Hugo 0.104.3"></head><body class=colorscheme-auto onload=twemoji.parse(document.body)><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Vladimir Samoylov</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/experience/>Experience</a></li><li class=navigation-item><a class=navigation-link href=/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/education/>Education</a></li><li class=navigation-item><a class=navigation-link href=/recommend/>Recommend</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://cageyv.dev/posts/aws-cloudtrail-to-slack/>What Is AWS CloudTrail, and Why Do You Need It</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2022-07-12T00:00:00Z>July 12, 2022</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
7-minute read</span></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i>
<a href=/categories/aws/>aws</a></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<a href=/tags/aws/>aws</a>
<span class=separator>•</span>
<a href=/tags/cloudtrail/>cloudtrail</a>
<span class=separator>•</span>
<a href=/tags/slack/>slack</a>
<span class=separator>•</span>
<a href=/tags/terraform/>terraform</a></div></div></header><div><p>Don’t have enough resources to set up a security department but want to stay on top of your AWS CloudTrail events? Find out how the CloudTrail-to-Slack Terraform module by <a href=https://fivexl.io/>FivexL</a> solves this problem for startups and small teams.</p><h2 id=terraform-module-for-aws-cloudtrail--an-effective-security-tool>Terraform Module for AWS CloudTrail — An Effective Security Tool
<a class=heading-link href=#terraform-module-for-aws-cloudtrail--an-effective-security-tool><i class="fa fa-link" aria-hidden=true></i></a></h2><p>While large corporations have their own Security Operations Centers (SOCs) responsible for information security and can afford expensive solutions, startups usually don’t have enough resources and time to set up such a luxury. Therefore, they have to look for simple security solutions to protect their data. Understanding the pain of limited resources, FivexL developed the Cloudtrail-to-Slack Terraform Module.</p><p>The module works with data gathered from AWS CloudTrail and sends notifications to Slack to keep you updated on what is happening in CloudTrail practically in real-time. Think of it as a surveillance camera that is not constantly monitored but notifies you if something suspicious happens — for example, if a stranger keeps moving near your front or back door.</p><h3 id=what-is-aws-cloudtrail>What Is AWS CloudTrail?
<a class=heading-link href=#what-is-aws-cloudtrail><i class="fa fa-link" aria-hidden=true></i></a></h3><p>Let’s briefly discuss AWS CloudTrail. AWS CloudTrail is an AWS service that helps you enable governance, compliance, and operational and risk auditing of your AWS account. Actions taken by a user, role, or an AWS service are recorded as events in CloudTrail. Events include actions taken in the AWS Management Console, AWS Command Line Interface, and AWS SDKs and APIs. More info: <a href=https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-user-guide.html>What is CloudTrail?</a></p><p>Visibility into this type of data is a key element of corporate security, as you can identify who did what, when, where, and how, as well as what resources were used. As a result, you can always stay on top of what is happening in your Amazon Console to fix misconfigurations timely and prevent intrusions. On the one hand, you have all the data to ensure your security, on the other hand, you are still an easy target for cybercriminals. Here are some reasons why:</p><h4 id=too-many-events-to-keep-track-of-manually>Too Many Events to Keep Track of Manually
<a class=heading-link href=#too-many-events-to-keep-track-of-manually><i class="fa fa-link" aria-hidden=true></i></a></h4><p>Even a startup or a small team will have a lot of logs to monitor. Therefore, you can easily miss an important event worth your attention. For example, you may not notice failed API calls because of a lack of permission, which may indicate incorrect operations setup or intrusion. While in the former case, you merely need to get rid of misconfigurations, in the latter case, you need to prevent a cyber attack that may cost you your business.</p><p>Imagine you are using a root user to login into your Amazon Console. Cybercriminals can steal your static credentials, change a password, and basically steal your data, together with business. We recommend applying Single Sign-on (SSO) or Identity and Access Management (IAM), together with multifactor authentication (MFA). This way, your credentials will expire within a certain period of time, which leaves a short opportunity window for a hacker.</p><h4 id=complicated-and-hard-to-comprehend-cloudwatch-notifications>Complicated and Hard-to-Comprehend CloudWatch Notifications
<a class=heading-link href=#complicated-and-hard-to-comprehend-cloudwatch-notifications><i class="fa fa-link" aria-hidden=true></i></a></h4><p>You can set up notifications from CloudWatch that will send alerts to your email if some suspicious events are recorded. But be ready to devote a lot of time and effort to set them up and comprehend them.</p><h2 id=stay-on-top-of-your-cloudtrail-events-easily-with-cloudtrail-to-slack-terraform-module>Stay on Top of Your CloudTrail Events Easily With CloudTrail-to-Slack Terraform Module
<a class=heading-link href=#stay-on-top-of-your-cloudtrail-events-easily-with-cloudtrail-to-slack-terraform-module><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Sending notifications about AWS CloudTrail events to Slack is a useful feature for startups implemented in the Cloudtrail-to-Slack Terraform module by FivexL. We have built a Python-based Lambda that analyzes all the recorded events in CloudTrails and sends notifications to Slack if they’re categorized as suspicious logs according to rules. Delivering Lamda to AWS is already a solved problem and we decided to use the open source module from <a href=https://registry.terraform.io/modules/terraform-aws-modules/lambda/aws/latest>Terraform AWS Modules</a>. So, this is a ready-made flexible CloudTrail-to-Slack Terraform module. You need only to set it up in a couple of seconds, and the following alerts will be sent to your Slack channel:</p><ul><li>Activities done by a root account</li><li>Failed API calls, and suspicious</li><li>Console logins without MFA</li><li>Sensitive events like IAM, network, and data storage access changes</li></ul><p><img src=/images/posts/aws_cloudtrail_to_slack/1.png alt=FistImage></p><p>As a result, you are always aware if something odd is going on in your AWS Console without investing extra time and effort. Chief Cloud Economist at The Duckbill Group, Corey Quinn, who helps companies decrease their AWS bills, mentioned the module in <a href=https://www.lastweekinaws.com/podcast/aws-morning-brief/security-awareness-training-in-five-minutes/>his podcast dedicated to security awareness training</a>: ‘I found a Terraform module that <a href=https://github.com/fivexl/Terraform-aws-CloudTrail-to-Slack>deploys Lambda</a> to watch CloudTrail and report to Slack - got all that? Good lord - whenever certain things happen. Those things include root logins, console logins without MFA, API calls that failed due to lack of permissions, and more. This might get noisy, but I’d consider deploying at least the big important ones’. This makes the module worth paying attention to.</p><p>Please, note: there is an approximate 5-10 minutes alert delivery delay because the current version is built upon parsing of S3 notifications.</p><h2 id=cloudtrail-to-slack-terraform-module-features>CloudTrail-to-Slack Terraform Module Features
<a class=heading-link href=#cloudtrail-to-slack-terraform-module-features><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Besides allowing startups to stay on top of CloudTrail events, the Terraform module grants startups flexibility. Here are the main benefits:</p><h3 id=adjustable-ready-made-rules>Adjustable Ready-Made Rules
<a class=heading-link href=#adjustable-ready-made-rules><i class="fa fa-link" aria-hidden=true></i></a></h3><p>Startups are known to have little to no time because of limited human resources. To facilitate module setup, there is a set of default rules; they are Python strings that are evaluated during the runtime and designed to return the bool value. The CloudTrail event is flattened prior to processing and should be referenced as an event variable.</p><p>Rules can also be ignored. In this case, an event is ignored by Lambda, and no notification is sent to Slack. “Ignore rules” has the same syntax as default ones. But it is highly recommended to fix alerts instead of ignoring them. This approach should be implemented only when there is no opportunity to fix the alert. Here is how you can do this.</p><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#fff;font-weight:700>locals</span> {
</span></span><span style=display:flex><span>  cloudtrail_ignore_rules = [
</span></span><span style=display:flex><span>      &#34;&#39;userIdentity.accountId&#39; in event and event[&#39;userIdentity.accountId&#39;] == <span style=color:red>&#39;</span><span style=color:#ff0;font-weight:700>11111111111</span><span style=color:red>&#39;&#34;</span>,
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}<span style=color:#007f7f>
</span></span></span><span style=display:flex><span><span style=color:#007f7f># we recomend storing hook url in SSM Parameter store and not commit it to the repo
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span><span style=color:#fff;font-weight:700>data</span> <span style=color:#0ff;font-weight:700>&#34;aws_ssm_parameter&#34; &#34;hook&#34;</span> {
</span></span><span style=display:flex><span>  name = <span style=color:#0ff;font-weight:700>&#34;/cloudtrail-to-slack/hook&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>module</span> <span style=color:#0ff;font-weight:700>&#34;cloudtrail_to_slack&#34;</span> {
</span></span><span style=display:flex><span>  source                         = <span style=color:#0ff;font-weight:700>&#34;fivexl/cloudtrail-to-slack/aws&#34;</span>
</span></span><span style=display:flex><span>  version                        = <span style=color:#0ff;font-weight:700>&#34;2.3.0&#34;</span>
</span></span><span style=display:flex><span>  default_slack_hook_url         = <span style=color:#fff;font-weight:700>data</span>.<span style=color:#fff;font-weight:700>aws_ssm_parameter</span>.<span style=color:#fff;font-weight:700>hook</span>.<span style=color:#fff;font-weight:700>value</span>
</span></span><span style=display:flex><span>  cloudtrail_logs_s3_bucket_name = <span style=color:#fff;font-weight:700>aws_s3_bucket</span>.<span style=color:#fff;font-weight:700>cloudtrail</span>.<span style=color:#fff;font-weight:700>id</span>
</span></span><span style=display:flex><span>  ignore_rules                   = <span style=color:#fff;font-weight:700>join</span>(<span style=color:#0ff;font-weight:700>&#34;,&#34;</span>, <span style=color:#fff;font-weight:700>local</span>.<span style=color:#fff;font-weight:700>cloudtrail_ignore_rules</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=customizing-notifications>Customizing Notifications
<a class=heading-link href=#customizing-notifications><i class="fa fa-link" aria-hidden=true></i></a></h3><p>You may not want all team members to receive security alerts from the Terraform module. Some may use the information to their advantage, while others may merely be bumped with tons of irrelevant notifications, which disrupts productivity and isn’t affordable for a startup. Here’s why the module gives an opportunity to customize notifications. For example, they can be sent to different Slack channels for different accounts according to the event account ID.</p><h3 id=user-defined-rules-to-match-events>User-Defined Rules To Match Events
<a class=heading-link href=#user-defined-rules-to-match-events><i class="fa fa-link" aria-hidden=true></i></a></h3><p>If the default rules don’t cover all your needs, you can set up user-defined rules to stay in control of what’s going on in CloudTrail. Here’s how to deploy the module with a list of the events that are necessary to track.</p><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#fff;font-weight:700>data</span> <span style=color:#0ff;font-weight:700>&#34;aws_ssm_parameter&#34; &#34;hook&#34;</span> {
</span></span><span style=display:flex><span>  name = <span style=color:#0ff;font-weight:700>&#34;/cloudtrail-to-slack/hook&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>locals</span> {<span style=color:#007f7f>
</span></span></span><span style=display:flex><span><span style=color:#007f7f>  # CloudTrail events
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span>  cloudtrail = <span style=color:#0ff;font-weight:700>&#34;DeleteTrail,StopLogging,UpdateTrail&#34;</span><span style=color:#007f7f>
</span></span></span><span style=display:flex><span><span style=color:#007f7f>  # EC2 Instance connect and EC2 events
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span>  ec2 = <span style=color:#0ff;font-weight:700>&#34;SendSSHPublicKey&#34;</span><span style=color:#007f7f>
</span></span></span><span style=display:flex><span><span style=color:#007f7f>  # Config
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span>  config = <span style=color:#0ff;font-weight:700>&#34;DeleteConfigRule,DeleteConfigurationRecorder,DeleteDeliveryChannel,DeleteEvaluationResults&#34;</span><span style=color:#007f7f>
</span></span></span><span style=display:flex><span><span style=color:#007f7f>  # All events
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span>  events_to_track = <span style=color:#0ff;font-weight:700>&#34;${local.cloudtrail},${local.ec2},${local.config}&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>module</span> <span style=color:#0ff;font-weight:700>&#34;cloudtrail_to_slack&#34;</span> {
</span></span><span style=display:flex><span>  source                         = <span style=color:#0ff;font-weight:700>&#34;fivexl/cloudtrail-to-slack/aws&#34;</span>
</span></span><span style=display:flex><span>  version                        = <span style=color:#0ff;font-weight:700>&#34;2.0.0&#34;</span>
</span></span><span style=display:flex><span>  default_slack_hook_url         = <span style=color:#fff;font-weight:700>data</span>.<span style=color:#fff;font-weight:700>aws_ssm_parameter</span>.<span style=color:#fff;font-weight:700>hook</span>.<span style=color:#fff;font-weight:700>value</span>
</span></span><span style=display:flex><span>  cloudtrail_logs_s3_bucket_name = <span style=color:#fff;font-weight:700>aws_s3_bucket</span>.<span style=color:#fff;font-weight:700>cloudtrail</span>.<span style=color:#fff;font-weight:700>id</span>
</span></span><span style=display:flex><span>  events_to_track                = <span style=color:#fff;font-weight:700>local</span>.<span style=color:#fff;font-weight:700>events_to_track</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>resource</span> <span style=color:#0ff;font-weight:700>&#34;aws_cloudtrail&#34; &#34;main&#34;</span> {
</span></span><span style=display:flex><span>  name           = <span style=color:#0ff;font-weight:700>&#34;main&#34;</span>
</span></span><span style=display:flex><span>  s3_bucket_name = <span style=color:#fff;font-weight:700>aws_s3_bucket</span>.<span style=color:#fff;font-weight:700>cloudtrail</span>.<span style=color:#fff;font-weight:700>id</span>
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>resource</span> <span style=color:#0ff;font-weight:700>&#34;aws_s3_bucket&#34; &#34;cloudtrail&#34;</span> {
</span></span><span style=display:flex><span>  ....
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=conclusion>Conclusion
<a class=heading-link href=#conclusion><i class="fa fa-link" aria-hidden=true></i></a></h2><p>The FivexL Cloudtrail-to-Slack Terraform module is a simple tool for you to stay on top of your CloudTrail events and ensure your Amazon Console is secure and properly set up. You can be notified about actions performed by a root account, failed API permissions, and console logins without MFA. Besides this, you can specify which sensitive events you wish to track, set up new rules to extend monitoring beyond default rules, and adjust who receives the notifications. For more info about the Cloudtrail-to-Slack Terraform module, please, check out <a href=https://github.com/fivexl/terraform-aws-cloudtrail-to-slack>FivexL&rsquo;s GitHub</a>.
As a result, startups and small teams can focus on core operations while being sure their data and business are safe. However, if your CloudTrail records too many events, FivexL Terraform Module may be insufficient.</p></div><footer><section class=see-also><h3 id=see-also-in-aws>See also in AWS
<a class=heading-link href=#see-also-in-aws><i class="fa fa-link" aria-hidden=true></i></a></h3><nav><ul><li><a href=/posts/aws-vault/>Security Basics in AWS or How To Get Rid of Hardcoded Credential and Reduce Data Leakage Risks with aws-vault</a></li><li><a href=/posts/aws-ec2-spot/>How To Save Resources With the Terraform Module for AWS Spot Instances</a></li></ul></nav></section></footer></article></section></div><footer class=footer><section class=container><p>Hosted on GitHub Pages.</p>©
2019 -
2022
Vladimir Samoylov</section></footer></main><script src=/js/dark-mode.min.c2d8a1f8f2660e4a46d776277c72695a1e0ca65939d79f754441d47551604af5.js integrity="sha256-wtih+PJmDkpG13YnfHJpWh4Mplk51591REHUdVFgSvU="></script></body></html>