<!doctype html><html lang=en><head><title>lprobe: A Secure, Open-Source Local Health Check Solution · Vladimir Samoylov</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self' https://cdnjs.cloudflare.com/ajax/libs/photoswipe/; object-src 'none'; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net/ https://cdnjs.cloudflare.com/ajax/libs/photoswipe/; script-src 'self' 'unsafe-inline' https://code.jquery.com/ https://cdnjs.cloudflare.com/ajax/libs/photoswipe/ https://twemoji.maxcdn.com https://static.cloudflareinsights.com/; prefetch-src 'self'; connect-src 'self';"><meta name=author content="Vladimir Samoylov"><meta name=description content="lprobe: A One-Stop-Shop Tool for Secure, Local Health Checks Link to heading Even if your app is functioning, that doesn’t always mean it’s working correctly. For you to securely and easily ensure your local container is healthy before the system fails, FivexL developed an open-source automated local health check solution - lprobe.
A vivid example is an eternal timeout: your app doesn’t crash but keeps waiting for a system response."><meta name=keywords content="devops,k8s,aws,terraform,cloud,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="lprobe: A Secure, Open-Source Local Health Check Solution"><meta name=twitter:description content="lprobe: A One-Stop-Shop Tool for Secure, Local Health Checks Link to heading Even if your app is functioning, that doesn’t always mean it’s working correctly. For you to securely and easily ensure your local container is healthy before the system fails, FivexL developed an open-source automated local health check solution - lprobe.
A vivid example is an eternal timeout: your app doesn’t crash but keeps waiting for a system response."><meta property="og:title" content="lprobe: A Secure, Open-Source Local Health Check Solution"><meta property="og:description" content="lprobe: A One-Stop-Shop Tool for Secure, Local Health Checks Link to heading Even if your app is functioning, that doesn’t always mean it’s working correctly. For you to securely and easily ensure your local container is healthy before the system fails, FivexL developed an open-source automated local health check solution - lprobe.
A vivid example is an eternal timeout: your app doesn’t crash but keeps waiting for a system response."><meta property="og:type" content="article"><meta property="og:url" content="https://cageyv.dev/posts/lprobe/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-15T00:00:00+00:00"><meta property="article:modified_time" content="2023-01-15T00:00:00+00:00"><link rel=canonical href=https://cageyv.dev/posts/lprobe/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.91a868ee18a9037f08fd2caaef42ed2af5db6cf2cc844a75b45b4198c1465b19.css integrity="sha256-kaho7hipA38I/Syq70LtKvXbbPLMhEp1tFtBmMFGWxk=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.78b5fe3864945faf5207fb8fe3ab2320d49c3365def0e88ac1df0ddadc54a03c.css integrity="sha256-eLX+OGSUX69SB/uP46sjINScM2Xe8OiKwd8N2txUoDw=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.107.0"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Vladimir Samoylov</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/experience/>Experience</a></li><li class=navigation-item><a class=navigation-link href=/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/education/>Education</a></li><li class=navigation-item><a class=navigation-link href=/recommend/>Recommend</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://cageyv.dev/posts/lprobe/>lprobe: A Secure, Open-Source Local Health Check Solution</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2023-01-15T00:00:00Z>January 15, 2023</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
7-minute read</span></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i>
<a href=/categories/opensource/>opensource</a></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/opensource/>opensource</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/security/>security</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/docker/>docker</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/containers/>containers</a></span></div></div></header><div><h2 id=lprobe-a-one-stop-shop-tool-for-secure-local-health-checks>lprobe: A One-Stop-Shop Tool for Secure, Local Health Checks
<a class=heading-link href=#lprobe-a-one-stop-shop-tool-for-secure-local-health-checks><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Even if your app is functioning, that doesn’t always mean it’s working correctly. For you to securely and easily ensure your local container is healthy before the system fails, FivexL developed an open-source automated local health check solution - <a href=https://github.com/fivexl/lprobe>lprobe</a>.<br>A vivid example is an eternal timeout: your app doesn’t crash but keeps waiting for a system response. If you receive no alert that there is no response within, let’s say, 30 seconds, you may not notice something is wrong. Here comes a health check to ensure your app is working correctly.</p><h3 id=what-is-a-health-check>What Is a Health Check?
<a class=heading-link href=#what-is-a-health-check><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>Health check is a process of checking whether a specific resource inside your local container is working correctly. The command conducts regular health checks within set time intervals and alerts you if the system fails to perform. That’s how lprobe works.<br>Suppose you need to validate external systems and find out if your app can access a database or bucket, record something, etc. For you not to miss a problem, lprobe automatically runs the command within a predefined interval to ensure your container is healthy. If it isn’t, try turning it off and on or reload a container.</p><p><em>A quick reminder: all the further information is relevant for both API and Web Services. lprobe can also cover the majority of needs for both, as it doesn’t cover the needs of an app with no interface at all.</em></p><h3 id=how-the-problem-was-solved-before-lprobe>How The Problem Was Solved Before lprobe?
<a class=heading-link href=#how-the-problem-was-solved-before-lprobe><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>Today, there are several traditional methods to run health checks: curl or wget commands. Even if you don’t have them, the guides will advise you to install and run them, neglecting all the security precautions.<br>In reality, you <strong>undermine your app’s protection</strong> significantly, since wget/curl commands are used in scripts and allow for downloading other utilities for a further attack. If an attacker is inside your file system and it’s not read-only, they will be able to download info from the web and run a code or binary files—all this leaves a <strong>huge opportunity window for an intruder</strong>.<br>If you want a more secure option, guides will suggest you write your own code, which takes extra time and effort to integrate and maintain it. <strong>FivexL developed a reliable and well-protected local health check solution - lprobe.</strong> Let’s find out why it’s more convenient and secure compared to existing health check alternatives.</p><h3 id=traditional-health-check-methods-for-docker-ecs-and-kubernetes-mtls-and-istio-cases>Traditional Health Check Methods for Docker, ECS, and Kubernetes (mTLS and Istio cases)
<a class=heading-link href=#traditional-health-check-methods-for-docker-ecs-and-kubernetes-mtls-and-istio-cases><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>If you Google how to conduct a local health check, the top results will keep shouting one thing: that wget and curl are your best options. We have conducted research to figure out what is proposed for different local health checks.</p><p><strong>Docker Health Check</strong><br>If you need a command to make docker ensure your container is performing correctly, 99% of guides recommend using a traditional CMD curl or CMD wget, like in this <a href=https://docs.docker.com/engine/reference/builder/#healthcheck>example</a>.</p><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>HEALTCHECK --interval=5m --timeout=3s \
</span></span><span style=display:flex><span>    CMD curl -f http://localhost/ || exit 1
</span></span></code></pre></div><p>In terms of code, you need to pay attention to the output. Set up only two outputs: 0 - for a successful health check, meaning everything is working as it should, and 1 - for an unhealthy status.</p><p><strong>Amazon ECS Health Check</strong><br><a href=https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definition_parameters.html#container_definition_healthcheck>The Amazon ECS Container documentation</a> focuses on the same commands and sets out two options to run a health check command:</p><ul><li>The default one is CMD, which runs directly. It is the only option for containers without a shell.</li><li>The other one is CMD-SHELL, which runs with the container&rsquo;s default shell.</li></ul><p>Why do we mention this? The documentation only has one example of a CMD-SHELL, and this also uses the curl tool. You could try to search for more information about heath checks for containers in the re:post, but you will still find CMD-SHELL + curl/wget recommendations. Here is one <a href=https://repost.aws/questions/QUfrOJiYQERXGAOgHGt1GW-w/container-health-check-for-ecs-task-with-awsvpc-network-mode>example</a>.<br>All this once again proves the fact that curl and wget are now deeply fixated in people&rsquo;s brains.</p><p><strong>Kubernetes Health Check</strong><br>Kubernetes has <a href=https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#define-a-liveness-http-request>embedded features</a> to run health checks with no extra effort. You can initiate it with an HTTP-get-command or run a gRPC liveness probe for Kubernetes v. 1.24. This is no longer an option once you add Istio Sidecar with mTLS because liveness probes take place outside the service mesh.</p><p>Here, once again, all the tribute goes to an infamous wget (a standard command probe), exec is run, and you get health check results.</p><h3 id=which-health-check-solution-does-chatgpt-suggest>Which Health Check Solution Does ChatGPT Suggest?
<a class=heading-link href=#which-health-check-solution-does-chatgpt-suggest><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>Even AI can’t find a better option than using insecure commands or third-party tools that are vulnerable to intruders. To prove this, we asked ChatGPT for a health check solution. The FivexL team requested the following:<br><em>“I want you to act as a Cloud Engineer with a focus on AWS and Container Security. You will give advice about Docker Containers and Dockerfiles and help to create the most secure Dockerfile, and it will not be an empty one. My first request is, &ldquo;I need a Dockerfile with a HEALTHCHECK instruction in it. Please use the most secure tool or command to run the health check&rdquo;</em><br>Here’s what ChatGPT suggested:</p><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#fff;font-weight:700>FROM</span><span style=color:#0ff;font-weight:700> alpine:latest</span><span style=color:red>
</span></span></span><span style=display:flex><span><span style=color:red></span><span style=color:#fff;font-weight:700>RUN</span> apk add --no-cache curl<span style=color:red>
</span></span></span><span style=display:flex><span><span style=color:red>HEALTHCHECK --interval=30s --timeout=30s </span>--start-period=5s --retries=<span style=color:#ff0;font-weight:700>3</span> <span style=color:#0ff;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#0ff;font-weight:700></span>  CMD curl -f http://localhost/ || <span style=color:#fff;font-weight:700>exit</span> <span style=color:#ff0;font-weight:700>1</span><span style=color:red>
</span></span></span><span style=display:flex><span><span style=color:red></span><span style=color:#fff;font-weight:700>CMD</span> [<span style=color:#0ff;font-weight:700>&#34;/bin/sh&#34;</span>]<span style=color:red>
</span></span></span></code></pre></div><p>This Dockerfile specifies that the health check should run every 30 seconds, with a timeout of 30 seconds and a start period of 5 seconds. It also specifies that the health check should be retried 3 times if it fails. The curl command is used to check the status of the http://localhost/ endpoint. If the curl command returns an error, the health check will fail and the container will be considered unhealthy.<br>You can also use other tools or commands to perform the health check, depending on your specific requirements. For example, you might use wget or httpie instead of curl, or you might use a tool like nmap to perform a network scan. Ultimately, the choice of tool or command will depend on your specific needs and the resources that are available within your container.</p><h3 id=a-single-solution-for-everyone-lprobe>A Single Solution for Everyone: lprobe
<a class=heading-link href=#a-single-solution-for-everyone-lprobe><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>Еnterprises usually code their proprietary binary tool and add it to a docker image to run health checks while maintaining a proper security level. Although the code is simple, it requires time to write and maintain it. To do this task once and for all, we at FivexL have created <a href=https://github.com/fivexl/lprobe>lprobe — an open-source health check run tool</a>.<br>With a name that originated from “local probe,” lprobe can become a one-stop-shop health check runner for every startup that wants to focus on a core product:</p><ul><li>Those who do secure containers based on a scratch image without a shell or other utilities</li><li>Those who use ECS</li><li>Those who use Kubernetes with Istio and have to suffer with a CMD-probe.</li></ul><p>The best thing — it is a ready-made open-source solution to securely run your health checks. It now supports <strong>two protocols</strong>: <em>HTTP and GRPC</em>. The latter is designed thanks to the Grpc health probe, added by Google to Kubernetes 1.23. On your request, we can add other protocols like the Apache JServ Protocol.<br>In the near future, we plan to further enhance the tool’s functionality to ensure it meets the demands of as many companies as possible. If you have any specific requirements or ideas on how to make lprobe better, feel free to share your feedback.<br>We would be glad if you collaborate with us for the sake of secure local health checks. Also, we would appreciate it if you <a href=https://github.com/fivexl/lprobe>rate lprobe on GitHub</a> to promote trust across the community.</p></div><footer><section class=see-also></section></footer></article></section></div><footer class=footer><section class=container>©
2019 -
2023
Vladimir Samoylov
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script></body></html>